openapi: '3.0.3'
info:
  version: '1.0.0-oas3'
  title: OIAP
  description: 
    Open Info API para Puertos. 
    This file contains all the APIs developed for the `Open Info API para Puertos` project for the **Rail Transport Domain** within the initiative Ports 4.0 form Puertos del Estado (ES). 
  termsOfService: http://swagger.io/terms/
  license:
    name: CC0 1.0 Universal (CC0 1.0)
    url: https://creativecommons.org/publicdomain/zero/1.0/deed.es
  contact:
    name: OpenInfoAPI github
    url: https://github.com/portdebarcelona/OpenInfoAPI-Ports
tags:
  - name: Rail Transport
    description: "APIs related to the flow of trains and cargo by rail in a port."
    externalDocs:
      description: Description 
      url: http://swagger.io  # It must be a link to a GitHub file with a more extensive description 
servers:
  - url: https://raw.githubusercontent.com/portdebarcelona/OpenInfoAPI-Ports/develop/oasdefinitions
    description: Servidor server 
# Canvi efectuat: 'https://raw.githubusercontent.com/portdebarcelona/OpenInfoAPI-Ports/develop/oasdefinitions a '.
paths:
  /railTransport/railConnections:
    get:
      tags:
        - Rail Transport
      summary: Returns a list of rail connections from a port.
      description: Returns a list of rail connections from a port. 
      parameters:
        - $ref: '#/components/parameters/portCode'
      responses: #status code
        '200':
          description: Successful operation
          headers:
            apiVersion:
              $ref: './oiapComponents.yml#/components/headers/apiVersion'
          content: 
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/railConnection'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: './oiapComponents.yml#/components/schemas/error' 
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: './oiapComponents.yml#/components/schemas/error'  
  /railTransport/inlandTerminals:
    get:
      tags:
        - Rail Transport
      summary: Returns the list of the inland terminals served by rail from a port. 
      description: >-
        This GET API returns the list of the inland terminals served by rail from a port.
      parameters:
        - $ref: '#/components/parameters/portCode'
      responses: #status code
        '200':
          description: Successful operation
          headers:
            apiVersion:
              $ref: './oiapComponents.yml#/components/headers/apiVersion'
          content: 
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/inlandTerminal'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: './oiapComponents.yml#/components/schemas/error' 
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: './oiapComponents.yml#/components/schemas/error' 
  /railTransport/railUndertaking:
    get:
      tags:
        - Rail Transport
      summary: List of the rail undertaking companies that operate in one port.
      description: Returns a list of the rail undertaking companies that operate in a port.
      parameters:
        - $ref: '#/components/parameters/portCode'
      responses: #status code
        '200':
          description: Successful operation
          headers:
            apiVersion:
              $ref: './oiapComponents.yml#/components/headers/apiVersion'
          content: 
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/railUndertaking'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: './oiapComponents.yml#/components/schemas/error' 
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: './oiapComponents.yml#/components/schemas/error'
  /railTransport/logisticServiceProvider:
    get:
      tags:
        - Rail Transport
      summary: List of the logistic service providers that operate in one port.
      description: Returns a list of the logistic service providers that operate in a port.
      parameters:
        - $ref: '#/components/parameters/portCode'
      responses: #status code
        '200':
          description: Successful operation
          headers:
            apiVersion:
              $ref: './oiapComponents.yml#/components/headers/apiVersion'
          content: 
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/logisticServiceProvider'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: './oiapComponents.yml#/components/schemas/error' 
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: './oiapComponents.yml#/components/schemas/error'
  # Train Arrivals
  /railTransport/arrivals:
    get:
      tags:
        - Rail Transport
      summary: Returns a list of trains that have arrived or will arrive today at a port. 
      description: Returns a list of trains that have arrived or will arrive today at a port.
      parameters:
        - $ref: '#/components/parameters/portCode'
      responses: #status code
        '200':
          description: Successful operation
          headers:
            apiVersion:
              $ref: './oiapComponents.yml#/components/headers/apiVersion'
          content: 
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/trainArrivals'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: './oiapComponents.yml#/components/schemas/error' 
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: './oiapComponents.yml#/components/schemas/error'

  # Train Departures
  /railTransport/departures:
    get:
      tags:
        - Rail Transport
      summary: Returns a list of trains that have departed or will depart today from a port. 
      description: Returns a list of trains that have departed or will depart today from a port.
      parameters:
        - $ref: '#/components/parameters/portCode'
      responses: #status code
        '200':
          description: Successful operation
          headers:
            apiVersion:
              $ref: './oiapComponents.yml#/components/headers/apiVersion'
          content: 
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/trainDepartures'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: './oiapComponents.yml#/components/schemas/error' 
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: './oiapComponents.yml#/components/schemas/error'
  
components:
  parameters: 
    portCode:
      in: query
      name: portCode
      description: |
            Port UN/LOCODE
            Default value is Locode of Port what provides the services
            example: portCode=ESBCN        
      required: false
      style: form
      explode: false
      schema:
        $ref: './oiapComponents.yml#/components/schemas/portCode'
    publishingStage:  
      in: query
      name: publishingStage
      description: 
            The stage of the publishing process of a notice. There are only two possible stages, ACTIVE and EXPIRED. This parameter must be used when the publishing process is EXPIRED. If not provided, the ACTIVE stage is used by default.
      required: false
      style: form
      explode: false
      schema:
        $ref: './oiapComponents.yml#/components/schemas/publishingStage'
    fromDate:  
      in: query
      name: fromDate
      description: 
            The date (day) from the expired notices are requested. The value is populated in ISO 8601 Date format (eg. 2022-01-30). This parameter is only needed to retrieve the expired notices and to limit their number.
      required: false
      style: form
      explode: false
      schema:
        $ref: './oiapComponents.yml#/components/schemas/fromDate'
    id:  
      in: query
      name: id
      description: 
            The unique identification of a notice.
      required: false
      style: form
      explode: false
      schema:
        $ref: './oiapComponents.yml#/components/schemas/id'
  schemas:
    railConnection: # Important definir aquesta estructura de dades. Mirar Sòstrat !!!
      description: ''
      type: object
      allOf:
        - type: object
          properties:
            railService:  # railServiceName and railServiceCode
              $ref: './oiapComponents.yml#/components/schemas/railService'        

    inlandTerminal: # Important definir aquesta estructura de dades. Mirar Sòstrat !!!
      description: ''
      type: object
      allOf:
        - type: object
          properties:
            locode:  # nearest LOCODE
              $ref: './oiapComponents.yml#/components/schemas/locode' 
        - type: object
          properties:
            railTerminalCode:  # Veure si existeix una taula d'estacions
              $ref: './oiapComponents.yml#/components/schemas/railTerminalCode' 

    railUndertaking: # Es tracta d'una empresa estàndard - Veure schema.org
      description: ''
      type: object
      allOf:
        - type: object
          properties:
            companyName:  
              $ref: './oiapComponents.yml#/components/schemas/companyName' 
      required: 
        - companyName

    logisticServiceProvider: # Es tracta d'una empresa estàndard - Veure schema.org
      description: ''
      type: object
      allOf:
        - type: object
          properties:
            companyName:  
              $ref: './oiapComponents.yml#/components/schemas/companyName' 
      required: 
        - companyName 

    trainArrivals: # S'ha de particularitzar per als trens
      description: list of trains that have arrived or will arrive today
      type: object
      allOf:
        - type: object
          properties:
            shipIMONumber:
              $ref: './oiapComponents.yml#/components/schemas/shipIMONumber'
        - type: object
          properties:
            shipName:
              $ref: './oiapComponents.yml#/components/schemas/shipName'
        - type: object
          properties:
            shipType:
              $ref: './oiapComponents.yml#/components/schemas/shipType'
        - type: object
          properties:
            actualTimeOfArrival:
              $ref: './oiapComponents.yml#/components/schemas/actualTimeOfArrival'
        - type: object
          properties:
            estimatedTimeOfArrival:
              $ref: './oiapComponents.yml#/components/schemas/estimatedTimeOfArrival'
        - type: object
          properties:
            nextPortOfCall:
              $ref: './oiapComponents.yml#/components/schemas/lastPortOfCall'
        - type: object
          properties:
            berth:
              $ref: './oiapComponents.yml#/components/schemas/berth'
      required: 
        - shipIMONumber
        - shipName
        - shipType
        - estimatedTimeOfArrival
        - berth  

    trainDepartures: # S'ha de particularitzar per als trens
      description: list of trains that have departed or will depart today
      type: object
      allOf:
        - type: object
          properties:
            shipIMONumber:
              $ref: './oiapComponents.yml#/components/schemas/shipIMONumber'
        - type: object
          properties:
            shipName:
              $ref: './oiapComponents.yml#/components/schemas/shipName'
        - type: object
          properties:
            shipType:
              $ref: './oiapComponents.yml#/components/schemas/shipType'
        - type: object
          properties:
            actualTimeOfArrival:
              $ref: './oiapComponents.yml#/components/schemas/actualTimeOfArrival'
        - type: object
          properties:
            estimatedTimeOfArrival:
              $ref: './oiapComponents.yml#/components/schemas/estimatedTimeOfArrival'
        - type: object
          properties:
            nextPortOfCall:
              $ref: './oiapComponents.yml#/components/schemas/lastPortOfCall'
        - type: object
          properties:
            berth:
              $ref: './oiapComponents.yml#/components/schemas/berth'
      required: 
        - shipIMONumber
        - shipName
        - shipType
        - estimatedTimeOfArrival
        - berth  